<!-- REPLACE THE ENTIRE CONTENT OF templates/records.html WITH THIS BLOCK -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ 'Doctor View | ' + user.name if doctor_view else 'My Health Records' }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Feather Icons Script -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>
<body>
    <div class="layout-wrapper">
        <aside class="sidebar">
            <header class="sidebar-header">MediChain</header>
            <nav>
                {% if doctor_view and session.user_id %}
                <a href="#" class="active"><i data-feather="file-text"></i> Patient Records</a>
                {% elif not doctor_view and session.user_id %}
                <a href="{{ url_for('dashboard') }}"><i data-feather="home"></i> Home</a>
                <a href="{{ url_for('records') }}" class="active"><i data-feather="file-text"></i> Records</a>
                <a href="#"><i data-feather="calendar"></i> Appointments</a>
                <a href="#"><i data-feather="message-square"></i> Messages</a>
                {% endif %}
            </nav>
            {% if not doctor_view %}
            <div class="sidebar-footer">
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
            {% endif %}
        </aside>

        <!-- THIS IS THE SECTION THAT WAS MISSING -->
        <main class="main-content">
            <header class="records-header">
                <h1>{{ 'Records for: ' + user.name if doctor_view else 'My Health Records' }}</h1>
                {% if doctor_view %}
                <a href="{{ url_for('upload_page', patient_id=patient_id) }}" class="btn btn-primary">Upload New Record</a>
                {% endif %}
            </header>

            <div class="filter-nav">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="Visit Summary">Visits</button>
                <button class="filter-btn" data-filter="Lab Results">Labs</button>
                <button class="filter-btn" data-filter="Vaccination">Vaccines</button>
                <button class="filter-btn" data-filter="Imaging">Imaging</button>
            </div>

            <div class="records-list">
                {% for record in records %}
                <a href="{{ url_for('record_detail', record_id=record.id) if not doctor_view else record.file_url }}" 
                   class="record-item record-item-filterable" 
                   data-classification="{{ record.classification }}"
                   {% if doctor_view %}target="_blank"{% endif %}>
                    <div class="record-icon">
                        <i data-feather="file"></i>
                    </div>
                    <div class="record-info">
                        <strong>{{ record.file_name }}</strong>
                        <span>{{ record.classification | default('PDF', true) | upper }}</span>
                    </div>
                    <div class="record-date">{{ record.uploaded_at.split('T')[0] }}</div>
                </a>
                {% else %}
                <div class="record-item" style="justify-content: center;">
                    <p>No records found for this patient.</p>
                </div>
                {% endfor %}
            </div>
        </main>
        <!-- END OF THE MISSING SECTION -->

    </div>
    <!-- Script to activate icons -->
    <script>
      feather.replace()
    </script>
    <!-- Link to the main JavaScript file that contains the filtering logic -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>