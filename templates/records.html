<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ 'Doctor View | ' + user.name if doctor_view else 'My Health Records' }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="layout-wrapper">
        <aside class="sidebar">
            <header class="sidebar-header">MediChain</header>
            <nav>
                    {# If a doctor is logged in and viewing, show this #}
                    {% if doctor_view and session.user_id %}
                    <a href="#" class="active">Patient Records</a>
                    {# If a patient is logged in and viewing their own records #}
                    {% elif not doctor_view and session.user_id %}

                <a href="{{ url_for('dashboard') }}">Home</a>
                <a href="{{ url_for('records') }}" class="active">Records</a>
                <a href="#">Appointments</a>
                <a href="#">Messages</a>
                {% endif %}
            </nav>
            
            {% if not doctor_view %}
            <div class="sidebar-footer">
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
            {% endif %}
        </aside>

        <main class="main-content">
            <header class="records-header">
                <h1>{{ 'Records for: ' + user.name if doctor_view else 'My Health Records' }}</h1>
                
                {% if doctor_view %}
                <a href="{{ url_for('upload_page', patient_id=patient_id) }}" class="btn btn-primary">Upload New Record</a>
                {% endif %}
            </header>

            <div class="records-list">
                {% for record in records %}
                <!-- 
                  THIS IS THE FIX: The link now ALWAYS goes to the record_detail page.
                  The target="_blank" is also removed for consistency.
                -->
                <a href="{{ url_for('record_detail', record_id=record.id) }}" class="record-item">
                    <div class="record-icon">ðŸ“„</div>
                    <div class="record-info">
                        <strong>{{ record.file_name }}</strong>
                        <span>{{ record.classification | default('PDF', true) | upper }}</span>
                    </div>
                    <div class="record-date">{{ record.uploaded_at.split('T')[0] }}</div>
                </a>
                {% else %}
                <div class="record-item" style="justify-content: center;">
                    <p>No records found for this patient.</p>
                </div>
                {% endfor %}
            </div>
        </main>
    </div>
</body>
</html>
